<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Outfit AI ç©¿æ­æ¨è–¦</title>
  <style>
    body {
      font-family: "Segoe UI", "Noto Sans TC", sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 10px 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.08);
      padding: 16px 24px;
    }
    h1 {
      margin-top: 0;
      margin-bottom: 8px;
    }
    .subtitle {
      margin-top: 0;
      margin-bottom: 20px;
      color: #555;
      font-size: 14px;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }
    label {
      font-weight: 600;
      font-size: 14px;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      padding: 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      resize: vertical;
      box-sizing: border-box;
    }
    select, button {
      padding: 10px 14px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-sizing: border-box;
    }
    button {
      background-color: #4285f4;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: 600;
      position: relative;
    }
    button:hover {
      background-color: #3367d6;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    /* è¼‰å…¥å‹•ç•« */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .loading.active {
      display: block;
    }
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4285f4;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* éŒ¯èª¤æç¤º */
    .error-message {
      background-color: #fee;
      border-left: 4px solid #f44;
      padding: 12px;
      border-radius: 4px;
      margin: 10px 0;
      color: #c33;
      display: none;
    }
    .error-message.active {
      display: block;
    }
    
    /* æˆåŠŸæç¤º */
    .success-message {
      background-color: #efe;
      border-left: 4px solid #4c4;
      padding: 12px;
      border-radius: 4px;
      margin: 10px 0;
      color: #363;
    }
    .section {
      margin-bottom: 24px;
    }
    .section h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 18px;
    }
    .keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .keyword-tag {
      padding: 4px 10px;
      border-radius: 999px;
      background-color: #e9f0ff;
      font-size: 13px;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background: #f7f7f9;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      margin: 0;
    }
    .outfit-card {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .outfit-image {
      width: 120px;
      min-width: 120px;
      height: 120px;
      border-radius: 8px;
      object-fit: cover;
      background-color: #f4f4f4;
      display: block;
    }
    .outfit-image-placeholder {
      width: 120px;
      min-width: 120px;
      height: 120px;
      border-radius: 8px;
      background: repeating-linear-gradient(
        45deg,
        #f4f4f4,
        #f4f4f4 10px,
        #e4e4e4 10px,
        #e4e4e4 20px
      );
    }
    .outfit-info h3 {
      margin: 0 0 4px 0;
      font-size: 16px;
    }
    .outfit-meta {
      margin: 0 0 8px 0;
      font-size: 13px;
      color: #777;
    }
    .outfit-desc {
      margin: 0 0 6px 0;
      font-size: 14px;
    }
    .items-list {
      margin-top: 4px;
      padding-left: 18px;
      font-size: 14px;
    }
    .items-list li {
      margin-bottom: 2px;
    }
    .empty-tip {
      font-size: 14px;
      color: #777;
    }

    /* åœ¨å°è¦–çª— / iframe è£¡ä¹Ÿèƒ½å¥½çœ‹ä¸€é» */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 16px;
      }
      .outfit-card {
        flex-direction: column;
        align-items: stretch;
      }
      .outfit-image,
      .outfit-image-placeholder {
        width: 100%;
        height: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‘— Outfit AI ç©¿æ­æ¨è–¦</h1>
    <p class="subtitle">
      è«‹æè¿°ä½ çš„ç©¿æ­éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šã€Œä»Šå¤©è¦å»ç´„æœƒï¼Œä½†æœ‰é»å†·ã€ï¼Œæˆ–ã€Œæ˜å¤©è¦å»ä¸Šç­ç°¡å ±ã€ã€‚
    </p>

    <!-- ğŸ”¹ æŸ¥è©¢è¡¨å–®ï¼šPOST å›åˆ° /recommend_page -->
    <form method="POST" id="recommendForm">
      <div>
        <label for="message">ä½ çš„éœ€æ±‚ï¼š</label>
        <textarea
          id="message"
          name="message"
          placeholder="è¼¸å…¥ä½ ä»Šå¤©çš„å ´åˆã€é¢¨æ ¼æˆ–å¤©æ°£æè¿°..."
          required
        >{{ user_input or '' }}</textarea>
      </div>

      <div>
        <label for="model">é¸æ“‡æ¨¡å‹ï¼ˆå¯é¸ï¼‰ï¼š</label>
        <select id="model" name="model">
          <option value="auto" {% if selected_model == 'auto' %}selected{% endif %}>è‡ªå‹•é¸æ“‡</option>
          <option value="gemini" {% if selected_model == 'gemini' %}selected{% endif %}>Gemini</option>
          <option value="groq" {% if selected_model == 'groq' %}selected{% endif %}>Groq</option>
          <option value="deepseek" {% if selected_model == 'deepseek' %}selected{% endif %}>DeepSeek</option>
        </select>
      </div>

      <button type="submit" id="submitBtn">é€å‡ºæŸ¥è©¢</button>
    </form>

    <!-- è¼‰å…¥å‹•ç•« -->
    <div class="loading" id="loadingDiv">
      <div class="spinner"></div>
      <p>ğŸ¤– AI æ­£åœ¨æ€è€ƒç©¿æ­å»ºè­°ï¼Œè«‹ç¨å€™...</p>
    </div>

    <!-- éŒ¯èª¤è¨Šæ¯ -->
    <div class="error-message" id="errorDiv"></div>

    <!-- ğŸ” é—œéµå­—å€å¡Š -->
    {% if keywords %}
    <div class="section">
      <h2>ğŸ” åµæ¸¬åˆ°çš„é—œéµå­—</h2>
      <div class="keywords">
        {% for kw in keywords %}
        <span class="keyword-tag">{{ kw }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- ğŸ’¬ AI æ–‡å­—å›è¦† -->
    {% if ai_response %}
    <div class="section">
      <h2>ğŸ’¬ AI æ¨è–¦èªªæ˜</h2>
      <pre>{{ ai_response }}</pre>
    </div>
    {% elif user_input %}
    <!-- æœ‰è¼¸å…¥ä½†æ²’æœ‰å›è¦†ï¼ˆç†è«–ä¸Šä¸å¤ªæœƒç™¼ç”Ÿï¼‰ï¼Œçµ¦å€‹æç¤º -->
    <div class="section">
      <h2>ğŸ’¬ AI æ¨è–¦èªªæ˜</h2>
      <p class="empty-tip">å·²æ”¶åˆ°ä½ çš„è¼¸å…¥ï¼Œä½†ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„ AI å›æ‡‰ã€‚</p>
    </div>
    {% endif %}

    <!-- ğŸ§¥ æ¨è–¦ç©¿æ­ / æœå°‹çµæœ -->
    {% if outfits %}
    <div class="section">
      <h2>ğŸ§¥ æ¨è–¦ç©¿æ­çµ„åˆ</h2>

      {% for outfit in outfits %}
      <div class="outfit-card">
        <!-- ç©¿æ­åœ–ç‰‡ï¼šå¦‚æœ DB æœ‰ image_url å°±é¡¯ç¤ºï¼Œæ²’æœ‰å°±ç”¨ placeholder -->
        {% if outfit._image %}
          <img
            src="{{ outfit._image }}"
            alt="{{ outfit._title }}"
            class="outfit-image"
          />
        {% else %}
          <div class="outfit-image-placeholder"></div>
        {% endif %}

        <div class="outfit-info">
          <h3>{{ outfit._title }}</h3>

          {% if outfit._occasion %}
          <p class="outfit-meta">å ´åˆï¼š{{ outfit._occasion }}</p>
          {% endif %}

          {% if outfit._description %}
          <p class="outfit-desc">{{ outfit._description }}</p>
          {% endif %}

          {% if outfit['items'] %}
           <ul class="items-list">
            {% for item in outfit['items'] %}
            <li>
             {{ item.name }}
             {% if item.color %} - {{ item.color }}{% endif %}
             {% if item.category %}ï¼ˆ{{ item.category }}ï¼‰{% endif %}
            </li>
           {% endfor %}
          </ul>
{% endif %}

        </div>
      </div>
      {% endfor %}
    </div>
    {% elif ai_response %}
    <!-- æœ‰ AI å›è¦†ä½†æ²’æœ‰ outfitsï¼ˆç†è«–ä¸Šæ¯”è¼ƒå°‘ï¼‰ï¼Œä¹Ÿæç¤ºä¸€ä¸‹ -->
    <div class="section">
      <h2>ğŸ§¥ æ¨è–¦ç©¿æ­çµ„åˆ</h2>
      <p class="empty-tip">ç›®å‰æ²’æœ‰é¡å¤–çš„ç©¿æ­çµ„åˆå¯ä»¥é¡¯ç¤ºã€‚</p>
    </div>
    {% endif %}
  </div>

  <script>
    // è¡¨å–®æäº¤è™•ç†
    const form = document.getElementById('recommendForm');
    const submitBtn = document.getElementById('submitBtn');
    const loadingDiv = document.getElementById('loadingDiv');
    const errorDiv = document.getElementById('errorDiv');

    // æª¢æŸ¥æ˜¯å¦æœ‰ AI å›æ‡‰éŒ¯èª¤
    {% if ai_response and ('âŒ' in ai_response or 'éŒ¯èª¤' in ai_response or 'å¤±æ•—' in ai_response or 'ç„¡æ³•' in ai_response) %}
    errorDiv.textContent = 'âš ï¸ AI æœå‹™å›æ‡‰ç•°å¸¸ï¼Œå¯èƒ½æ˜¯ API é…é¡ä¸è¶³æˆ–é€£ç·šå•é¡Œã€‚è«‹ç¨å¾Œå†è©¦æˆ–åˆ‡æ›å…¶ä»–æ¨¡å‹ã€‚';
    errorDiv.classList.add('active');
    {% endif %}

    form.addEventListener('submit', function(e) {
      const message = document.getElementById('message').value.trim();
      if (!message) {
        e.preventDefault();
        errorDiv.textContent = 'âš ï¸ è«‹è¼¸å…¥æ‚¨çš„ç©¿æ­éœ€æ±‚';
        errorDiv.classList.add('active');
        return;
      }

      // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
      loadingDiv.classList.add('active');
      submitBtn.disabled = true;
      submitBtn.textContent = 'è™•ç†ä¸­...';
      errorDiv.classList.remove('active');
      
      // è¡¨å–®æœƒè‡ªå‹•æäº¤ï¼Œé é¢é‡æ–°è¼‰å…¥å¾Œæœƒé¡¯ç¤ºçµæœ
    });

    // å¦‚æœæœ‰ AI å›æ‡‰ï¼Œéš±è—è¼‰å…¥å‹•ç•«
    {% if ai_response %}
    loadingDiv.classList.remove('active');
    {% endif %}
  </script>
</body>
</html>
